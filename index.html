<!doctype html>
<!â€”
paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/
-->
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <title>HTML5 Hacks</title>
  <meta name="description" content="">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <!-- Place favicon.ico and apple-touch-icon.png in the root
directory: mathiasbynens.be/notes/touch-icons -->

  <link rel="stylesheet" href="css/style.css">

  <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->

  <!-- All JavaScript at the bottom, except this Modernizr build.
       Modernizr enables HTML5 elements & feature detects for
optimal performance.
       Create your own custom Modernizr build:
www.modernizr.com/download/ -->
  <script src="js/libs/modernizr-2.5.3.min.js"></script>
<script type="text/javascript">
      var host = "https://liquidhub.herokuapp.com".replace(/^http/, 'ws');
      var ws = new WebSocket(host);
      var interval = null;

      ws.onmessage = function (e) {
        try {
          var payload = JSON.parse(e.data);
          if(payload.channel == "organization" && payload.organization == "{!$Organization.Id}") {
            update_counter(payload.data);
            update_chart(payload.data);
            update_gauge(payload.data);
          }
        } catch(err) {
          console.log('WS_Malformed', err);
        }

        if(!interval) {
          interval = setInterval(function() {ws.send('PING')},45000);
        }
      };
  </script>
</head>
<body>

  <header>

  </header>
  <div role="main">
	<div style="width:25%; float: left; margin-right:3%;">
        <!-- START Counter Visual -->
        <div id="counterwrap">
            <h3 id="counter">
                <i class="fa fa-cog fa-spin"></i>
            </h3>
        </div>

        <script>
            function update_counter(data) {
                console.log(data);
                // Border for hot...
                // #CAA21C
                $('#counter').fadeOut(500, function() {
                    $('#counter').text(Math.round(data));
                    $('#counter').fadeIn(500);
                    if (data > 80) {
                        $('#counterwrap').css('backgroundcolor', '#EAC95A');
                    } else {
                        $('#counterwrap').css('backgroundcolor', '#E9F2FF');
                    }
                });
            }
        </script>

        <style>
            img.logo {
                width: 80px;
                margin-top: 32px;
                float: left;
            }

            #counterwrap {
                float: left;
                margin-left: 30%;
                width: 140px;
                background-color: #E9F2FF;
                text-align: center;
                height: 95px;
                border-radius: 50%;
                margin-top: 40px;
                font-size: 4em;
                color: #333;
                padding-top: 45px;
                border: 4px solid #3541A3;
                background-size: contain;
            }
        </style>
    </div>
    <!-- END Counter Visual -->

    <div style="width:35%; float: left; margin-right:3%;">
        <!-- START Line Chart -->
        <script src="//liquidhub.herokuapp.com/js/smoothie.js"></script>
        <canvas id="mycanvas" style="margin-top:20px" width="450" height="180"></canvas>
        <script>
            var line1;
            var seriesOptions;

            // TODO - notification on refil that is needed...!
            function myYRangeFunction(range) {
                // TODO implement your calculation using range.min and range.max
                var min = 0;
                var max = 120;
                return {min: min, max: max};
            }

            function createTimeline() {
                // grid:{strokeStyle:'#3875d7'}
                var smoothie = new SmoothieChart({yRangeFunction:myYRangeFunction,timestampFormatter:SmoothieChart.timeFormatter,
                                                                                    millisPerPixel:120,grid:{fillStyle:'#ffffff',strokeStyle:'#cccccc',borderVisible:true},labels:{disabled:true}});

                /* fluidLevel = Math.random()*800; */

                line1 = new TimeSeries();

                /* line1.append(new Date().getTime(), fluidLevel); */

                smoothie.addTimeSeries(line1, {lineWidth:3.5,strokeStyle:'#3875d7',fillStyle:'rgba(181,213,255,0.30)'});
                smoothie.streamTo(document.getElementById("mycanvas"), 2000);

                for (var i = 0; i < smoothie.seriesSet.length; i++)
                {
                    if (smoothie.seriesSet[i].timeSeries === line1)
                    {
                        seriesOptions = smoothie.seriesSet[i].options;
                        break;
                    }
                }

                ////setInterval(function() {

                // TODO - uncomment for real data from fluid measurement
                /* var jqxhr = $.get( "http://arduino.local:5000/getlevel", function(data) { */
                    //var fluidLevel;
                    /* var jqxhr = $.get( serverAddress + '/fluidlevel', function(data) {
                            console.log(data);
                                fluidLevel = data.count;
                                line1.append(new Date().getTime(), fluidLevel);

                                // CHECK FOR COLOR BASED ON LEVEL....
                                if (fluidLevel < 35)
                                {
                                        seriesOptions.strokeStyle = '#CAA21C';
                                        seriesOptions.fillStyle = '#EAC95A';
                                }
                                else {
                                    seriesOptions.strokeStyle = '#3875d7';
                                    seriesOptions.fillStyle = 'rgba(181,213,255,0.30)';
                                }
                        })
                        .done(function() {
                        })
                        .fail(function() {
                            alert( "error" );
                        })
                        .always(function() {
                        }); */


                    /////  fluidLevel = 82; //Math.random()*800;
                    ////// line1.append(new Date().getTime(), fluidLevel);
                // }, 2000);
            }

            function update_chart(data) {
                console.log(data);
                //console.log(data);
                fluidLevel = Math.round(data);
                line1.append(new Date().getTime(), fluidLevel);

                // CHECK FOR COLOR BASED ON LEVEL....
                if (fluidLevel > 80) {
                    seriesOptions.strokeStyle = '#CAA21C';
                    seriesOptions.fillStyle = '#EAC95A';
                } else {
                    seriesOptions.strokeStyle = '#3875d7';
                    seriesOptions.fillStyle = 'rgba(181,213,255,0.30)';
                }
            }

            $(document).ready(function() { createTimeline(); });

        </script>
    </div>
    <!-- END Line Chart -->

    <div style="width:30%; float: left;">

        <!-- START Just Gauge -->
        <script src="//sfplatform.herokuapp.com/js/raphael.2.1.0.min.js"></script>
        <script src="//sfplatform.herokuapp.com/js/justgage.1.0.1.min.js"></script>

        <div id="g1"></div>

        <script>
            var g1;

            $(function() {
                g1 = new JustGage({
                    id: "g1",
                    value: 0,
                    min: 0,
                    max: 100,
                    title: "Temp",
                    label: "",
                    valueFontColor: '#333',
                    titleFontColor: '#fff',
                    levelColorsGradient: true
                });
            });

            function update_gauge(data) {
                g1.refresh(Math.round(data));
            }
        </script>

        <style>
            #g1 {
                width:300px; height:240px;
                display: inline-block;
                margin: 1em;
                margin-top:-30px;
            }
        </style>
    </div>
  </div>
  <footer>

  </footer>

  <!-- JavaScript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL;
fall back to local if offline -->
  <script
src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
</script>
<script>
  window.jQuery || document.write('
  <script src="js/libs/jquery-1.7.1.min.js"><\/script>')
</script>

  <!-- scripts concatenated and minified via build script -->
  <script src="js/plugins.js"></script>
  <script src="js/script.js"></script>
  <!-- end scripts -->

</body>
</html>
